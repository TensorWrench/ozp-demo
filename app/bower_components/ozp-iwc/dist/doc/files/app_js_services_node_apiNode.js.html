<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/js/services/node/apiNode.js - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ozpIwc"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ozpIwc.AjaxPersistenceQueue.html">ozpIwc.AjaxPersistenceQueue</a></li>
            
                <li><a href="../classes/ozpIwc.ApiBase.html">ozpIwc.ApiBase</a></li>
            
                <li><a href="../classes/ozpIwc.ApiError.html">ozpIwc.ApiError</a></li>
            
                <li><a href="../classes/ozpIwc.apiFilter.html">ozpIwc.apiFilter</a></li>
            
                <li><a href="../classes/ozpIwc.apiFilter.Function.html">ozpIwc.apiFilter.Function</a></li>
            
                <li><a href="../classes/ozpIwc.ApiNode.html">ozpIwc.ApiNode</a></li>
            
                <li><a href="../classes/ozpIwc.AsyncAction.html">ozpIwc.AsyncAction</a></li>
            
                <li><a href="../classes/ozpIwc.BadActionError.html">ozpIwc.BadActionError</a></li>
            
                <li><a href="../classes/ozpIwc.BadContentError.html">ozpIwc.BadContentError</a></li>
            
                <li><a href="../classes/ozpIwc.BadRequestError.html">ozpIwc.BadRequestError</a></li>
            
                <li><a href="../classes/ozpIwc.BadResourceError.html">ozpIwc.BadResourceError</a></li>
            
                <li><a href="../classes/ozpIwc.BadStateError.html">ozpIwc.BadStateError</a></li>
            
                <li><a href="../classes/ozpIwc.CancelableEvent.html">ozpIwc.CancelableEvent</a></li>
            
                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
            
                <li><a href="../classes/ozpIwc.ClientParticipant.html">ozpIwc.ClientParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiBase.html">ozpIwc.CommonApiBase</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiCollectionValue.html">ozpIwc.CommonApiCollectionValue</a></li>
            
                <li><a href="../classes/ozpIwc.CommonApiValue.html">ozpIwc.CommonApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.DataApi.html">ozpIwc.DataApi</a></li>
            
                <li><a href="../classes/ozpIwc.DataNode.html">ozpIwc.DataNode</a></li>
            
                <li><a href="../classes/ozpIwc.Endpoint.html">ozpIwc.Endpoint</a></li>
            
                <li><a href="../classes/ozpIwc.EndpointRegistry.html">ozpIwc.EndpointRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.Event.html">ozpIwc.Event</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentPacket.html">ozpIwc.FragmentPacket</a></li>
            
                <li><a href="../classes/ozpIwc.FragmentStore.html">ozpIwc.FragmentStore</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsApi.html">ozpIwc.IntentsApi</a></li>
            
                <li><a href="../classes/ozpIwc.IntentsInFlightNode.html">ozpIwc.IntentsInFlightNode</a></li>
            
                <li><a href="../classes/ozpIwc.InternalParticipant.html">ozpIwc.InternalParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.KeyBroadcastLocalStorageLink.html">ozpIwc.KeyBroadcastLocalStorageLink</a></li>
            
                <li><a href="../classes/ozpIwc.LeaderGroupParticipant.html">ozpIwc.LeaderGroupParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.Lifespan.Bound.html">ozpIwc.Lifespan.Bound</a></li>
            
                <li><a href="../classes/ozpIwc.Lifespan.Ephemeral.html">ozpIwc.Lifespan.Ephemeral</a></li>
            
                <li><a href="../classes/ozpIwc.Lifespan.Persistent.html">ozpIwc.Lifespan.Persistent</a></li>
            
                <li><a href="../classes/ozpIwc.LocksApi.html">ozpIwc.LocksApi</a></li>
            
                <li><a href="../classes/ozpIwc.LocksApiValue.html">ozpIwc.LocksApiValue</a></li>
            
                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
            
                <li><a href="../classes/ozpIwc.MetricsRegistry.html">ozpIwc.MetricsRegistry</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.Sample.html">ozpIwc.metricsStats.Sample</a></li>
            
                <li><a href="../classes/ozpIwc.metricsStats.UniformSample.html">ozpIwc.metricsStats.UniformSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.html">ozpIwc.metricStats</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.BinaryHeap.html">ozpIwc.metricStats.BinaryHeap</a></li>
            
                <li><a href="../classes/ozpIwc.metricStats.ExponentiallyDecayingSample.html">ozpIwc.metricStats.ExponentiallyDecayingSample</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.BaseMetric.html">ozpIwc.metricTypes.BaseMetric</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Counter.html">ozpIwc.metricTypes.Counter</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Gauge.html">ozpIwc.metricTypes.Gauge</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Histogram.html">ozpIwc.metricTypes.Histogram</a></li>
            
                <li><a href="../classes/ozpIwc.metricTypes.Meter.html">ozpIwc.metricTypes.Meter</a></li>
            
                <li><a href="../classes/ozpIwc.MulticastParticipant.html">ozpIwc.MulticastParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.NamesApi.html">ozpIwc.NamesApi</a></li>
            
                <li><a href="../classes/ozpIwc.NamesNode.html">ozpIwc.NamesNode</a></li>
            
                <li><a href="../classes/ozpIwc.NetworkPacket.html">ozpIwc.NetworkPacket</a></li>
            
                <li><a href="../classes/ozpIwc.NoActionError.html">ozpIwc.NoActionError</a></li>
            
                <li><a href="../classes/ozpIwc.NoMatchError.html">ozpIwc.NoMatchError</a></li>
            
                <li><a href="../classes/ozpIwc.NoPermissionError.html">ozpIwc.NoPermissionError</a></li>
            
                <li><a href="../classes/ozpIwc.NoResourceError.html">ozpIwc.NoResourceError</a></li>
            
                <li><a href="../classes/ozpIwc.PacketRouter.html">ozpIwc.PacketRouter</a></li>
            
                <li><a href="../classes/ozpIwc.packetRouter.html">ozpIwc.packetRouter</a></li>
            
                <li><a href="../classes/ozpIwc.Participant.html">ozpIwc.Participant</a></li>
            
                <li><a href="../classes/ozpIwc.Peer.html">ozpIwc.Peer</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.PDP.html">ozpIwc.policyAuth.PDP</a></li>
            
                <li><a href="../classes/ozpIwc.policyAuth.SecurityAttribute.html">ozpIwc.policyAuth.SecurityAttribute</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipant.html">ozpIwc.PostMessageParticipant</a></li>
            
                <li><a href="../classes/ozpIwc.PostMessageParticipantListener.html">ozpIwc.PostMessageParticipantListener</a></li>
            
                <li><a href="../classes/ozpIwc.Router.html">ozpIwc.Router</a></li>
            
                <li><a href="../classes/ozpIwc.RouterWatchdog.html">ozpIwc.RouterWatchdog</a></li>
            
                <li><a href="../classes/ozpIwc.standardApiFilters.html">ozpIwc.standardApiFilters</a></li>
            
                <li><a href="../classes/ozpIwc.SystemNode.html">ozpIwc.SystemNode</a></li>
            
                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacket.html">ozpIwc.TransportPacket</a></li>
            
                <li><a href="../classes/ozpIwc.TransportPacketContext.html">ozpIwc.TransportPacketContext</a></li>
            
                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
            
                <li><a href="../classes/ozpIwcPolicies.html">ozpIwcPolicies</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/bus.html">bus</a></li>
            
                <li><a href="../modules/bus.api.html">bus.api</a></li>
            
                <li><a href="../modules/bus.api.Type.html">bus.api.Type</a></li>
            
                <li><a href="../modules/bus.api.Value.html">bus.api.Value</a></li>
            
                <li><a href="../modules/bus.network.html">bus.network</a></li>
            
                <li><a href="../modules/bus.network.packets.html">bus.network.packets</a></li>
            
                <li><a href="../modules/bus.security.html">bus.security</a></li>
            
                <li><a href="../modules/bus.service.html">bus.service</a></li>
            
                <li><a href="../modules/bus.service.Type.html">bus.service.Type</a></li>
            
                <li><a href="../modules/bus.service.Value.html">bus.service.Value</a></li>
            
                <li><a href="../modules/bus.service.Value.Persistance.html">bus.service.Value.Persistance</a></li>
            
                <li><a href="../modules/bus.transport.html">bus.transport</a></li>
            
                <li><a href="../modules/bus.util.html">bus.util</a></li>
            
                <li><a href="../modules/client.html">client</a></li>
            
                <li><a href="../modules/common.html">common</a></li>
            
                <li><a href="../modules/metrics.html">metrics</a></li>
            
                <li><a href="../modules/metrics.statistics.html">metrics.statistics</a></li>
            
                <li><a href="../modules/metrics.types.html">metrics.types</a></li>
            
                <li><a href="../modules/ozpIwc.html">ozpIwc</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app/js/services/node/apiNode.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Service API Value classes of the bus.
 * @module bus.service
 * @submodule bus.service.Value
 */
/**
 *
 * @class ApiNode
 * @namespace ozpIwc
 * @constructor
 * @param {Object} config
 * @param {String} config.resource
 * @param {String[]} config.allowedContentTypes
 * @param {Object} config.entity
 * @param {String} config.contentType
 * @param {Number} config.version
 * @param {String} config.self
 * @param {String} config.serializedEntity
 * @param {String} config.serializedContentType
 */
ozpIwc.ApiNode= function(config) {
 	config = config || {};

    /**
     * @property resource
     * @type String
     */
	this.resource=config.resource;

    /**
     * @property allowedContentTypes
     * @type Array
     */
    this.allowedContentTypes=config.allowedContentTypes;

    /**
     * @property entity
     * @type Object
     */
    this.entity=config.entity;

    /**
     * @property contentType
     * @type String
     */
	this.contentType=config.contentType;
    /**
     * @property uriTemplate
     * @type String
     */
	// used if() to allow for subclasses to set the uriTemplate on the prototype
	// setting the field, even to undefined, would mask the prototype&#x27;s value
	if(config.uriTemplate) {
		this.uriTemplate=config.uriTemplate;
	}
    /**
     * @property permissions
     * @type Object
     * @default {}
     */
	this.permissions={};

    /**
     * @property version
     * @type Number
     * @default 0
     */
	this.version=config.version || 1;

    /**
     * @property lifespan
     * @type Boolean
     * @default false
     */
    this.lifespan= new ozpIwc.Lifespan.Ephemeral();

    /**
     * @property deleted
     * @type Boolean
     * @default true
     */
    this.deleted=false;

    /**
     * String to match for collection.
     * @property pattern
     * @type String
     */
    this.pattern = config.pattern;

    /**
     * @property collection
     * @type Array
     * @default []
     */
    this.collection = [];

    /**
     * @property self - The url backing this node 
     * @type String
     */
    this.self=config.self;
    
    if(config.serializedEntity) {
        this.deserializedEntity(config.serializedEntity,config.serializedContentType);
    }

    if(!this.resource) {
        throw new Error(&quot;ApiNode requires a resource&quot;);
    }
};

/**
 * Gathers the self uri from the uriTemplate property if it does not already exist.
 * @method getSelfUri
 * @returns {Number|*}
 */
ozpIwc.ApiNode.prototype.getSelfUri=function() {
	if(this.self) {
		return this.self;
	}
	if(this.uriTemplate &amp;&amp; ozpIwc.uriTemplate) {
		var template=ozpIwc.uriTemplate(this.uriTemplate);
		if(template) {
			this.self=ozpIwc.util.resolveUriTemplate(template,this);
		}
	}
	return this.self;
};

/**
 * Serialize the node to a form that conveys both persistent and
 * ephemeral state of the object to be handed off to a new API
 * leader.
 * 
 * __Intended to be overridden by subclasses__
 * @method serializeLive
 * @returns {Object}
 */
ozpIwc.ApiNode.prototype.serializeLive=function() {
    return this.toPacket({
        deleted: this.deleted,
        pattern: this.pattern,
        collection: this.collection,
        lifespan: this.lifespan,
        allowedContentTypes: this.allowedContentTypes,
       _links: {
           self: {href: this.self}
       }
    });
};

/**
 * Set the node using the state returned by serializeLive.
 *
 * __Intended to be overridden by subclasses__
 * 
 * @method deserializeLive
 * @param {Object} serializedForm The data returned from serializeLive
 * @return {Object} the content type of the serialized data
 */
ozpIwc.ApiNode.prototype.deserializeLive=function(serializedForm, serializedContentType) {
    serializedForm.contentType = serializedForm.contentType || serializedContentType;
    this.set(serializedForm);
    if(serializedForm._links &amp;&amp; serializedForm._links.self) {
        this.self=serializedForm._links.self.href;
    }
    if(!this.resource){
        this.resource = serializedForm.resource || this.resourceFallback(serializedForm);
    }
    this.deleted = serializedForm.deleted;
    this.lifespan= serializedForm.lifespan;
    this.allowedContentTypes=serializedForm.allowedContentTypes;
    this.pattern = serializedForm.pattern;
    this.collection = serializedForm.collection;
};


/**
 * If a resource path isn&#x27;t given, this takes the best guess at assigning it.
 * Overriden by subclasses.
 *
 * @method deserializeResourceFromContentType
 * @param serializedForm
 */
ozpIwc.ApiNode.prototype.deserializeResourceFromContentType = function(serializedForm) {
    if(serializedForm._links &amp;&amp; serializedForm._links.self){
        this.resource = serializedForm._links.self.href.replace(ozpIwc.apiRootUrl,&quot;&quot;);
    }
};

/**
 * Serializes the node for persistence to the server.
 *
 * __Intended to be overridden by subclasses__
 * 
 * @method serializedEntity
 * @return {String} a string serialization of the object
 */
ozpIwc.ApiNode.prototype.serializedEntity=function() {
    return JSON.stringify(this.entity);
};

/**
 * The content type of the data returned by serializedEntity()
 *
 * __Intended to be overridden by subclasses__
 * 
 * @method serializedContentType
 * @return {String} the content type of the serialized data
 */
ozpIwc.ApiNode.prototype.serializedContentType=function() {
    return this.contentType;
};

/**
 * Sets the api node from the serialized form.
 *
 * __Intended to be overridden by subclasses__
 * 
 * @method serializedEntity
 * @param {String} serializedForm A string serialization of the object
 * @param {String} contentType The contentType of the object
 * @return {Object}
 */
ozpIwc.ApiNode.prototype.deserializedEntity=function(serializedForm,contentType) {
    if(typeof(serializedForm) === &quot;string&quot;) {
        serializedForm=JSON.parse(serializedForm);
    }
    this.entity=serializedForm;
    this.contentType = contentType;
    if(this.entity &amp;&amp; this.entity._links) {
        var links = this.entity._links;
        if (!this.self &amp;&amp; links.self) {
            this.self = links.self.href;
        }
        if (!this.resource) {
            if (links[&quot;ozp:iwcSelf&quot;]) {
                this.resource = links[&quot;ozp:iwcSelf&quot;].href.replace(/web\+ozp:\/\/[^/]+/, &quot;&quot;);
            } else {
                this.resource = this.resourceFallback(serializedForm);
            }
        }
    }
};


/**
 * If a resource path isn&#x27;t given, this takes the best guess at assigning it.
 * @method resourceFallback
 * @param serializedForm
 */
ozpIwc.ApiNode.prototype.resourceFallback = function(serializedForm) {
    // do nothing, override if desired.
};

/**
 * Turns this value into a packet.
 *
 * @method toPacket
 * @param {ozpIwc.TransportPacket} base Fields to be merged into the packet.
 * @returns {ozpIwc.TransportPacket}
 */
ozpIwc.ApiNode.prototype.toPacket=function(base) {
	base = base || {};
	base.entity=ozpIwc.util.clone(this.entity);
    base.lifespan = this.lifespan;
	base.contentType=this.contentType;
	base.permissions=this.permissions;
	base.eTag=this.version;
	base.resource=this.resource;
    base.pattern = this.pattern;
    base.collection = this.collection;
	return base;
};


/**
 * Sets a data based upon the content of the packet.  Automatically updates the content type,
 * permissions, entity, and updates the version.
 *
 * @method set
 * @param {ozpIwc.TransportPacket} packet
 */
ozpIwc.ApiNode.prototype.set=function(packet) {
    if(!Array.isArray(packet.permissions)){
        for(var i in packet.permissions) {
            //If a permission was passed, wipe its value and set it to the new value;
            this.permissions.clear(i);
            this.permissions.pushIfNotExist(i,packet.permissions[i]);
        }
    }
    this.lifespan = ozpIwc.Lifespan.getLifespan(packet.lifespan) || this.lifespan;
    this.contentType=packet.contentType;
    this.entity=packet.entity;
    this.pattern = packet.pattern || this.pattern;
    this.deleted = false;
    if(packet.eTag) {
        this.version=packet.eTag;
    } else {
        this.version++;
    }
};

/**
 * Clears the entity of the node and marks as deleted.
 * @method markAsDeleted
 * @param {ozpIwc.TransportPacket} packet
 */
ozpIwc.ApiNode.prototype.markAsDeleted=function(packet) {
    this.version++;
    this.deleted=true;
    this.entity=null;
    this.pattern=null;
    this.collection=null;
};

/**
 * Adds a new watcher based upon the contents of the packet.
 *
 * @method addWatch
 * @param {ozpIwc.TransportPacket} watch
 */
ozpIwc.ApiNode.prototype.addWatch=function(watch) {
    this.watchers.push(watch);
};

/**
 * Removes all watchers who&#x27;s packet matches that which is passed in.
 * @method removeWatch
 * @param {ozpIwc.TransportPacket} filter
 */
ozpIwc.ApiNode.prototype.removeWatch=function(filter) {
    this.watchers=this.watchers.filter(filter);
};


/**
 * Generates a point-in-time snapshot of this value that can later be sent to
 * {@link ozpIwc.CommonApiValue#changesSince} to determine the changes made to the value.
 * This value should be considered opaque to consumers.
 * 
 * &lt;p&gt; For API subclasses, the default behavior is to simply call toPacket().  Subclasses
 * can override this, but should likely override {@link ozpIwc.CommonApiValue#changesSince}
 * as well.
 *
 * @method snapshot
 * @returns {object}
 */
ozpIwc.ApiNode.prototype.snapshot=function() {
	return this.toPacket();
};

/**
 * From a given snapshot, create a change notifications.  This is not a delta, rather it&#x27;s
 * change structure.
 * &lt;p&gt; API subclasses can override if there are additional change notifications (e.g. children in DataApi).
 *
 * @method changesSince
 * @param {object} snapshot The state of the value at some time in the past.
 * @returns {Object} A record of the current value and the value of the snapshot.
 */
ozpIwc.ApiNode.prototype.changesSince=function(snapshot) {
	if(snapshot.eTag === this.version) {
        return null;
    }
	return {
        &#x27;newValue&#x27;: this.toPacket(),
        &#x27;oldValue&#x27;: snapshot
	};
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
